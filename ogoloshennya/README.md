# Автоматичне витягування кількості оголошень

Готовий скрипт **extract_counts.py** читає список сайтів із `sites.csv`, завантажує HTML і витягує кількість або весь рядок за CSS‑селектором.
Працює без браузера (requests + BeautifulSoup), із тайм‑аутами, ретраями, кастомними заголовками та пост‑обробкою.

## Встановлення
Потрібен Python 3.9+
```bash
pip install requests beautifulsoup4 lxml
```

## Запуск (найпростіше)
```bash
python extract_counts.py --input sites.csv --out results.csv
```

## Формат `sites.csv`
Колонки:
- `label` — довільна назва сайту/фільтра (для зручності в репортах).
- `url` — повний URL сторінки результатів пошуку/каталогу.
- `selectors` — один або кілька CSS‑селекторів, розділених `||`. Перший, що спрацює, буде використано.
- `mode` — `text` (повернути весь текст вузла) або `number` (витягнути число з тексту через regex).
- `encoding` — (необов'язково) форсувати кодування сторінки, напр. `utf-8` або `windows-1251`.
- `regex_number` — (необов'язково) власний regex для числа (за замовчуванням: `([0-9][0-9\s\u00A0\,\.]*)`).

### Приклади селекторів
- Для **autobonus.lt**: `span.result-count` (тільки число у дужках) або `div.search-list-title h2` (весь рядок).
- Якщо сайт показує "Найдено объявлений: (2)" — обирай `number` для числа або `text` для повного рядка.

## CLI параметри
```
python extract_counts.py --input sites.csv --out results.csv --concurrency 4 --retries 2 --timeout 12 --user-agent "MyBot/1.0"
```
- `--concurrency` — скільки сайтів паралельно обробляти (псевдопаралельно, через ThreadPoolExecutor).
- `--retries` — кількість повторних спроб при помилках мережі або парсингу.
- `--timeout` — тайм‑аут HTTP‑запиту, сек.
- `--user-agent` — свій User‑Agent.
- `--print` — друкувати результати у консоль.
- `--raw` — також зберігати сирий фрагмент тексту, з якого витягнуте число.
- `--fail-on-miss` — завершити з ненульовим кодом, якщо хоч одне значення не витягнуто.

## Вихід `results.csv`
Колонки: `timestamp,label,url,ok,value,raw,selector_used,elapsed_ms,http_status,error`

---

## Швидкий старт
1) Відредагуй `sites.csv` і додай свої сторінки та селектори.
2) Запусти команду вище; подивись `results.csv` і/або вивід у консоль.
